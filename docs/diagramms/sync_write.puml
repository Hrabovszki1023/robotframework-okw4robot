@startuml SyncWrite
title OKW Sync-Strategie (Write: Click/SetValue/TypeKey/Select)

actor Test
participant "Keywords\n(Set/Select/Click)" as KW
participant "OkwWidget\n(WebSe_Base._wait_before 'write')" as W
participant "Adapter\n(SeleniumWebAdapter)" as AD
participant "Browser/DOM" as DOM

Test -> KW: SetValue/Select/Click/TypeKey(Name, ...)
KW -> W: resolve_widget(name)
KW -> W: widget.okw_set_value/okw_click/...
activate W
W -> W: _wait_before('write')
...
W -> AD: element_exists(locator)
AD -> DOM: query element
AD --> W: True/False
alt not exists
  W --> KW: fail [Sync] Element does not exist
end

opt scroll_into_view
  W -> AD: scroll_into_view(locator)
  AD -> DOM: scrollIntoView()
end

opt visible
  W -> AD: wait_until_visible(locator, timeout)
end

opt enabled
  loop until timeout (poll)
    W -> AD: is_enabled(locator)
    AD --> W: True/False
  end
  alt not enabled
    W --> KW: fail [Sync] Element not enabled
  end
end

opt editable (WebSe_TextField/WebSe_MultilineField)
  loop until timeout (poll)
    W -> AD: is_editable(locator)
    AD --> W: True/False
  end
  alt not editable
    W --> KW: fail [Sync] Element not editable
  end
end

opt project waits (until_not_visible)
  loop selectors
    W -> AD: wait_until_not_visible(selector, timeout)
  end
end

== perform action ==
W -> AD: click/select_by_label/clear_text+input_text/press_keys
AD -> DOM: apply action
deactivate W
KW --> Test: done

note right of KW
Globals (Robot Vars):
- ${OKW_SYNC_TIMEOUT_WRITE}
- ${OKW_SYNC_POLL}
- ${OKW_SYNC_SCROLL_INTO_VIEW}
- ${OKW_SYNC_CHECK_EDITABLE}
- ${OKW_BUSY_SELECTORS_WRITE}
Instance (YAML): wait.write {...}
end note

@enduml
